<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AWaDo 聊天机器人</title>
    <link rel="icon" href="awado_icon.png" type="image/png">
    <style>
        /* AWaDo 品牌配色与基础设置 */
        :root{
            --awado-bg: #0f1724; 
            --awado-card: #1e1e1e; 
            --awado-text: #e6eef6; 
            --awado-muted: #9aa4b2; 
            --awado-green: #2ecc71; 
            --awado-red: #e74c3c; 
            --awado-blue: #3498db; 
            --footer-height: 80px; /* 预估底部输入框高度 */
            --app-height: 100vh; /* JS 动态计算的视口高度 */
        }
        
        /* 1. 核心修复：移动端使用 JS 动态计算的 --app-height */
        html,body{
            height: var(--app-height); /* 使用动态高度 */
            margin:0;
            padding: 0;
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* 移除 body 上的 overflow: hidden，让浏览器自行处理键盘弹出时的滚动 */
        }
        body{
            background:var(--awado-bg);
            color:var(--awado-text);
            display:flex;
            justify-content:center;
        }

        /* 2. APP 容器：在手机端全屏，桌面端固定尺寸 */
        .app{
            width: 100%; 
            max-width: none; 
            height: var(--app-height); /* 使用动态高度 */
            background:var(--awado-card);
            border-radius:0; 
            box-shadow:none; 
            display:grid;
            grid-template-rows:60px 1fr; /* 头部高度减小到 60px */
            overflow:hidden; /* app 内部内容溢出隐藏，交给 chat 处理 */
        }
        
        /* ==================== 头部（Header） ==================== */
        header{
            display:flex;
            gap:10px;
            align-items:center;
            padding:10px 15px; 
            border-bottom:1px solid rgba(255,255,255,.05);
            background-color: #2c2c2c; 
        }
        header .logo{
            width:35px; 
            height:35px;
            border-radius:6px; 
            object-fit: contain;
        }
        header h1{font-size:16px;margin:0;color:var(--awado-red);font-weight:600;} 
        .controls{margin-left:auto;} 
        .controls select { display: none; }
        .small{display: none;} 

        /* ==================== 主面板（Pane） ==================== */
        .pane{
            display:flex;
            flex-direction: column;
            gap:0;
            padding:0;
            grid-row: 2 / 3;
            overflow: hidden; 
        }
        .sidebar{
            display: none; 
        }
        
        .chat{
            flex:1;
            background:#0b1220; 
            padding:0; 
            border-radius:0; 
            display:flex;
            flex-direction:column;
            position: relative; 
            overflow: hidden; 
        }
        
        /* ==================== 消息区（Messages）- 核心滚动区域 ==================== */
        .messages{
            padding:15px; 
            padding-bottom: var(--footer-height); /* 预留底部输入框空间 */
            overflow-y:auto; 
            -webkit-overflow-scrolling: touch; 
            flex:1; 
            display:flex;
            flex-direction:column;
            gap:12px;
        }
        .messages::-webkit-scrollbar {width: 0;} 
        .messages::-webkit-scrollbar-thumb {background-color: transparent;}
        
        .msg{
            max-width:90%; 
            padding:10px 12px; 
            border-radius:10px; 
            line-height:1.4; 
            font-size: 14px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1)
        }
        
        .msg.user{ margin-left:auto; background:linear-gradient(135deg,var(--awado-blue),#2980b9); color:white; border:1px solid rgba(52,152,219,.15); }
        .msg.ai{ margin-right:auto; background:linear-gradient(135deg,#1f3d33,#0b2d23); color:var(--awado-text); border:1px solid rgba(46,204,113,.15); }
        .msg > div:first-child{font-weight: bold; margin-bottom: 3px; font-size: 12px;}
        .msg.user > div:first-child{color: rgba(255,255,255,0.8);}
        .msg.ai > div:first-child{color: var(--awado-green);}

        .meta{
            font-size:11px;
            color:var(--awado-muted);
            padding:8px 15px; 
            border-bottom: 1px dashed rgba(255,255,255,.03); 
            text-align: center;
        }
        
        /* ==================== 底部（Footer） - 绝对定位固定底部 ==================== */
        footer{
            position: absolute; 
            bottom: 0;
            left: 0;
            right: 0;
            display:flex;
            gap:8px;
            padding:10px 15px;
            border-top:1px solid rgba(255,255,255,.05);
            align-items:flex-end;
            background-color: #2c2c2c;
            min-height: var(--footer-height); 
            box-sizing: border-box; 
            flex-shrink: 0;
            z-index: 10; /* 确保在消息气泡之上 */
        }
        textarea{
            flex:1;
            min-height:48px;
            max-height:100px;
            resize: none; /* 关键：确保手机端不能拖动 */
            padding:10px;
            border-radius:8px;
            background:#333; 
            border:1px solid rgba(255,255,255,.1);
            color:var(--awado-text);
            font-size:14px;
        }
        textarea:focus { border-color: var(--awado-green); outline: none; }
        
        .btn{
            padding:8px 12px;
            border-radius:8px;
            font-weight:600;
        }
        .footer-btns{
            display:flex;
            flex-direction:column;
            gap:6px;
            flex-shrink: 0;
        }

        /* 3. 桌面端样式 (Media Query 覆盖手机默认样式) */
        @media (min-width: 600px) {
            body {
                align-items: center; 
                padding: 24px;
            }
            .app{
                width:900px;
                max-width:95%;
                height:720px;
                border-radius:12px;
                box-shadow:0 8px 30px rgba(0,0,0,.5);
                grid-template-rows:72px 1fr;
                height: 720px; /* 桌面端使用固定像素高度 */
            }
            header{ padding: 14px 18px; height: 72px; }
            header .logo{ width:40px; height:40px; }
            header h1{ font-size:18px; }
            .small{display: block;} 
            .pane{
                flex-direction: row; 
                gap:18px;
                padding:18px;
            }
            .sidebar{
                display: block; 
                width:240px;
                align-self: stretch;
                padding: 15px;
                border-radius: 10px;
            }
            .chat{
                border-radius:10px;
                position: static; 
            }
            .messages{
                flex: 1; 
                padding:15px 10px;
                padding-bottom: 15px; /* 移除底部填充 */
                gap:15px;
            }
            .messages::-webkit-scrollbar {width: 8px;} 
            .messages::-webkit-scrollbar-thumb {background-color: rgba(255, 255, 255, 0.15);}
            .msg{
                max-width:85%;
                padding:12px 15px;
                font-size: 15px;
            }
            footer{
                position: static; 
                padding:12px 15px;
                gap: 10px;
                min-height: initial; 
            }
            textarea{
                min-height:56px;
                max-height:120px;
                resize: vertical; 
                padding: 12px;
                font-size: 15px;
            }
            .footer-btns{ gap:8px; }
            .btn{ padding:10px 14px; font-size: initial; }
        }
    </style>
</head>
<body>
    <div class="app" role="application">
        <header>
            <img src="awado_icon.png" alt="AWaDo AI Logo" class="logo"> 
            <div>
                <h1>AWaDo 聊天机器人</h1>
                <div class="small">基于规则的聊天系统，完全免费。</div>
            </div>
            <div class="controls">
            </div>
        </header>

        <div class="pane">
            <aside class="sidebar">
                <div class="note">
                    <p style="color:var(--awado-red); font-weight: 600; margin-top: 0;">工作原理:</p>
                    <ul style="padding-left: 20px; margin-top: 0;">
                        <li>本系统在浏览器端运行，不依赖任何外部 API。</li>
                        <li>机器人通过**关键词匹配**来回复预设的答案。</li>
                        <li>如果您询问超出预设规则的问题，它将回复默认信息。</li>
                    </ul>
                    <p style="color:var(--awado-green); font-weight: 600;">您可以尝试问：</p>
                    <ul style="padding-left: 20px;">
                        <li>卡皮巴拉（游戏名）</li>
                        <li>成员列表</li>
                        <li>主题曲</li>
                        <li>你好 / 谢谢</li>
                    </ul>
                </div>
            </aside>

            <section class="chat">
                <div class="meta">会话历史 — 本系统不会保存您的聊天记录。</div>
                <div id="messages" class="messages" aria-live="polite">
                    <div class="msg ai">
                        <div style="font-size:13px;color:var(--awado-green);margin-bottom:6px">AWaDo 机器人</div>
                        <div>
                            欢迎来到 AWaDo 聊天机器人！我是基于预设规则的助手。请问您有什么想了解的 AWaDo 工作室信息吗？
                        </div>
                    </div>
                </div>

                <footer>
                    <textarea id="input" placeholder="输入您的问题（Enter 发送）"></textarea>
                    <div class="footer-btns">
                        <button id="sendBtn" class="btn">发送</button>
                        <button id="clearBtn" class="btn secondary">清空</button>
                    </div>
                </footer>
            </section>
        </div>
    </div>

    <script>
        const messagesEl = document.getElementById('messages');
        const inputEl = document.getElementById('input');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const footerEl = document.querySelector('footer');

        // ===============================================
        // 核心规则：关键词匹配
        // ===============================================
        const rules = [
            {
                keywords: ['卡皮巴拉', '游戏', '作品', 'Capybara','game'],
                response: '我们的主打作品是《卡皮巴拉环游世界》！在这款治愈系冒险游戏中，您将陪伴可爱的卡皮巴拉探索世界，解决小谜题。这是一个放松心灵的旅程！'
            },
            {
                keywords: ['成员', '团队', '制作人','人'],
                response: 'AWaDo 工作室的核心成员包括：Programmer (ZIJUN), Sponsor (YUHENG), Director (SANGYUAN), Language (QINGHUA), Character Design (LEONGYI), 和 Art (SHUSHENG)。我们是六人小团队！'
            },
            {
                keywords: ['主题曲', '背景音乐', 'BGM','音乐','music'],
                response: '我们的主题曲是 `topic_bgm.mp3`。您可以在主页上点击播放按钮收听！它能带给您宁静与欢乐。'
            },
            {
                keywords: ['你好', '在吗', '喂','hallo','hi'],
                response: '你好！我是 AWaDo 规则聊天机器人，很高兴为您服务。请问您有什么问题呢？'
            },
            {
                keywords: ['谢谢', '感谢', '再见','tq'],
                response: '不客气！希望您在 AWaDo 的网站上玩得愉快。再见，祝您拥有美好的一天！'
            },
            {
                keywords: ['联系', 'Telegram', 'TG'],
                response: '您可以通过点击主页侧边栏的“前往 Telegram”按钮联系我们，提供反馈或寻求支持。'
            },
            {
                keywords: ['gay', '同性恋', '同志','男同'],
                response: '我不是gay，但ruitao是。'
            },
            {
                keywords: ['ruitao', 'sangyuan', 'leongyi','qinghua','shusheng'],
                response: '是gay。'
            }
        ];

        // 默认回复
        const defaultResponse = '抱歉，我只是一名规则机器人，无法理解您复杂的问题。';


        function addMessage(role, text){
            const div = document.createElement('div');
            div.className = 'msg ' + (role==='user'?'user':'ai');
            div.innerHTML = '<div style="font-size:13px; margin-bottom:6px">'+(role==='user'? '你':'AWaDo 机器人')+'</div>' +
                            '<div>' + escapeHtml(text).replace(/\n/g,'<br>') + '</div>';
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight; 
        }

        function escapeHtml(unsafe){
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/\"/g, "&quot;")
                .replace(/'/g, "&#039;")
        }
        
        function handleRuleBasedResponse(userInput) {
            const lowerCaseInput = userInput.toLowerCase();
            for (const rule of rules) {
                for (const keyword of rule.keywords) {
                    if (lowerCaseInput.includes(keyword.toLowerCase())) {
                        return rule.response;
                    }
                }
            }
            return defaultResponse;
        }

        function sendMessage(){
            const text = inputEl.value.trim();
            if(!text) return;
            
            addMessage('user', text);
            inputEl.value = '';

            const reply = handleRuleBasedResponse(text);
            
            setTimeout(() => {
                addMessage('ai', reply);
            }, 500); 
        }

        // ===============================================
        // 移动端高度/滚动修复函数
        // ===============================================
        
        // 修复 iOS/Android 浏览器 100vh 错误计算的函数
        const setAppHeight = () => {
            if (window.innerWidth < 600) {
                const doc = document.documentElement;
                // 获取当前视口高度，并将其设置为 CSS 变量
                doc.style.setProperty('--app-height', `${window.innerHeight}px`);
            } else {
                // 桌面端保持默认
                document.documentElement.style.setProperty('--app-height', `720px`);
            }
        };

        // 调整消息区域填充的函数
        const adjustMessagesPadding = () => {
            if (window.innerWidth < 600) {
                // 动态获取 footer 实际高度
                const footerHeight = footerEl.offsetHeight; 
                // 设置 CSS 变量，确保 messages 容器底部有足够的空间
                document.documentElement.style.setProperty('--footer-height', `${footerHeight + 15}px`); 
            } else {
                // 桌面端恢复默认值
                document.documentElement.style.setProperty('--footer-height', `15px`);
            }
            messagesEl.scrollTop = messagesEl.scrollHeight; // 重新滚动到底部
        };


        // 事件监听
        sendBtn.addEventListener('click', sendMessage);
        clearBtn.addEventListener('click', () => { 
            messagesEl.innerHTML=''; 
            inputEl.value=''; 
            addMessage('ai', '欢迎来到 AWaDo 聊天机器人！我是基于预设规则的助手。请问您有什么想了解的 AWaDo 工作室信息吗？');
        });

        inputEl.addEventListener('keydown', (e)=>{
            if(e.key === 'Enter' && !e.shiftKey){
                e.preventDefault(); sendMessage();
            }
        });
        
        // 监听窗口大小变化和输入框内容变化
        window.addEventListener('resize', () => {
            setAppHeight(); // 调整应用高度（修复 iOS/Android）
            adjustMessagesPadding(); // 调整消息区填充
        });

        // 监听输入框高度变化，确保 padding 总是适配
        inputEl.addEventListener('input', adjustMessagesPadding);
        
        // 页面加载完成后立即执行
        window.onload = () => {
            setAppHeight();
            adjustMessagesPadding();
        };

        // 键盘弹出后，确保滚动到底部
        inputEl.addEventListener('focus', () => {
            setTimeout(() => {
                messagesEl.scrollTop = messagesEl.scrollHeight;
            }, 300); // 延迟执行，等待虚拟键盘完全弹出
        });

    </script>
</body>
</html>
