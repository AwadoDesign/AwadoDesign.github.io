<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AWaDo AI æ™ºèƒ½åŠ©æ‰‹</title>
    <style>
        /* AWaDo å“ç‰Œé…è‰²ä¸åŸºç¡€è®¾ç½® */
        :root{
            --awado-bg: #0f1724; /* æ·±è“èƒŒæ™¯ */
            --awado-card: #1e1e1e; /* å¯¼èˆªæ /å¡ç‰‡æ·±è‰² */
            --awado-text: #e6eef6; /* ä¸»æ–‡æœ¬é¢œè‰² */
            --awado-muted: #9aa4b2; /* æ¬¡è¦æ–‡æœ¬é¢œè‰² */
            --awado-green: #2ecc71; /* å¼ºè°ƒè‰² 1: ç»¿è‰² (ä¸»é¢˜æ›²æŒ‰é’®è‰²) */
            --awado-red: #e74c3c; /* å¼ºè°ƒè‰² 2: çº¢è‰² (æœç´¢/æ ‡é¢˜è‰²) */
            --awado-blue: #3498db; /* å¼ºè°ƒè‰² 3: è“è‰² (TGæŒ‰é’®è‰²) */
        }
        html,body{height:100%;margin:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
        body{
            background:var(--awado-bg);
            color:var(--awado-text);
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px
        }
        .app{
            width:900px;
            max-width:95%;
            height:720px;
            background:var(--awado-card);
            border-radius:12px;
            box-shadow:0 8px 30px rgba(0,0,0,.5);
            display:grid;
            grid-template-rows:72px 1fr 1fr; 
            overflow:hidden
        }
        
        /* ==================== å¤´éƒ¨ï¼ˆHeaderï¼‰ ==================== */
        header{
            display:flex;
            gap:12px;
            align-items:center;
            padding:14px 18px;
            border-bottom:1px solid rgba(255,255,255,.05);
            background-color: #2c2c2c; /* ç•¥æµ…ä¸€ç‚¹çš„å¤´éƒ¨ */
        }
        header .logo{
            width:40px;
            height:40px;
            border-radius:8px;
            object-fit: contain;
        }
        header h1{font-size:18px;margin:0;color:var(--awado-red);font-weight:600;}
        .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
        .controls select{
            background:#333;
            border:1px solid rgba(255,255,255,.1);
            color:var(--awado-muted);
            padding:6px 8px;
            border-radius:6px;
            font-size:13px
        }
        .small{font-size:13px;color:var(--awado-muted)}
        .saved{font-size:12px;color:var(--awado-green);margin-left:6px} /* æ­¤ç‰ˆæœ¬ä¸­å·²éšè— */

        /* ==================== ä¸»é¢æ¿ï¼ˆPaneï¼‰ ==================== */
        .pane{display:flex;gap:18px;padding:18px;grid-row: 2 / 4;}
        .sidebar{
            width:240px;
            background:rgba(255,255,255,.03);
            padding:15px;
            border-radius:10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            align-self: flex-start;
        }
        .sidebar .note{font-size:13px;color:var(--awado-muted);line-height:1.6}
        .sidebar li{margin-bottom: 5px; color: var(--awado-muted);}
        
        .chat{
            flex:1;
            background:#0b1220; 
            padding:0; 
            border-radius:10px;
            display:flex;
            flex-direction:column;
            overflow: hidden; 
        }
        
        /* ==================== æ¶ˆæ¯åŒºï¼ˆMessagesï¼‰ ==================== */
        .messages{flex:1;overflow-y:auto;padding:15px 10px;display:flex;flex-direction:column;gap:15px}
        .messages::-webkit-scrollbar {width: 8px;}
        .messages::-webkit-scrollbar-thumb {background-color: rgba(255, 255, 255, 0.15);border-radius: 4px;}
        
        .msg{max-width:85%;padding:12px 15px;border-radius:12px;line-height:1.5;box-shadow: 0 1px 3px rgba(0,0,0,0.1)}
        
        /* ç”¨æˆ·æ¶ˆæ¯ (ä½¿ç”¨è“è‰²æ¸å˜) */
        .msg.user{
            margin-left:auto;
            background:linear-gradient(135deg,var(--awado-blue),#2980b9);
            color:white;
            border:1px solid rgba(52,152,219,.15);
        }
        /* AI æ¶ˆæ¯ (ä½¿ç”¨ç»¿è‰²å¼ºè°ƒè‰²) */
        .msg.ai{
            margin-right:auto;
            background:linear-gradient(135deg,#1f3d33,#0b2d23);
            color:var(--awado-text);
            border:1px solid rgba(46,204,113,.15);
        }
        .msg > div:first-child{font-weight: bold; margin-bottom: 4px; font-size: 13px;}
        .msg.user > div:first-child{color: rgba(255,255,255,0.8);}
        .msg.ai > div:first-child{color: var(--awado-green);}

        .meta{font-size:12px;color:var(--awado-muted);padding:8px 12px;border-bottom: 1px dashed rgba(255,255,255,.03);}
        
        /* ==================== åº•éƒ¨ï¼ˆFooterï¼‰ ==================== */
        footer{
            display:flex;
            gap:10px;
            padding:12px 15px;
            border-top:1px solid rgba(255,255,255,.05);
            align-items:center;
            background-color: #2c2c2c;
        }
        textarea{
            flex:1;
            min-height:56px;
            max-height:120px;
            resize:vertical;
            padding:12px;
            border-radius:10px;
            background:#333; 
            border:1px solid rgba(255,255,255,.1);
            color:var(--awado-text);
            font-size:15px;
            transition: border-color 0.2s;
        }
        textarea:focus { border-color: var(--awado-green); outline: none; }
        
        .btn{
            padding:10px 14px;
            background:linear-gradient(90deg,var(--awado-green),#27ae60);
            color:#032017;
            border:none;
            border-radius:10px;
            font-weight:600;
            cursor:pointer;
            box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
            transition: opacity 0.2s, transform 0.1s;
        }
        .btn:hover { opacity: 0.9; }
        .btn:active { transform: translateY(1px); }

        .btn.secondary{
            background:#444;
            border:1px solid #555;
            color:var(--awado-muted);
            box-shadow: none;
        }
        .btn.secondary:hover { background: #555; opacity: 1; }

        .system-box{
            width:100%;
            padding:8px;
            border-radius:8px;
            background:rgba(255,255,255,.05);
            border:1px dashed var(--awado-red); 
            color:var(--awado-muted);
            font-size:13px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="app" role="application">
        <header>
            <img src="awado_icon.png" alt="AWaDo AI Logo" class="logo"> 
            <div>
                <h1>AWaDo æ™ºèƒ½è®¾è®¡åŠ©ç†</h1>
                <div class="small">ç”± AWaDo Design Studio æä¾›æ”¯æŒï¼Œå·²é…ç½®ä¸“å± API Keyã€‚</div>
            </div>
            <div class="controls">
                <select id="model">
                    <option value="gpt-4o-mini">gpt-4o-mini</option>
                    <option value="gpt-4o">gpt-4o</option>
                    <option value="gpt-5-mini">gpt-5-mini</option>
                    <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                </select>
            </div>
        </header>

        <div class="pane">
            <aside class="sidebar">
                <div class="note">
                    <p style="color:var(--awado-red); font-weight: 600; margin-top: 0;">AWaDo AI åŠ©æ‰‹ç®€ä»‹:</p>
                    <ul style="padding-left: 20px; margin-top: 0;">
                        <li>ä¸“æ³¨äº AWaDo å·¥ä½œå®¤çš„æ¸¸æˆã€è®¾è®¡å’Œå¼€å‘æµç¨‹ã€‚</li>
                        <li>å¯ä»¥æŸ¥è¯¢é¡¹ç›®ä¿¡æ¯æˆ–è·å–é€šç”¨ AI å¸®åŠ©ã€‚</li>
                        <li>**API Key å·²é¢„è®¾**ï¼Œç”¨æˆ·æ— éœ€è¾“å…¥ï¼Œç›´æ¥å¼€å§‹èŠå¤©ã€‚</li>
                    </ul>
                </div>

                <div style="margin-top:18px">
                    <div class="small" style="color:var(--awado-text);">ç³»ç»Ÿæç¤ºï¼ˆSystemï¼‰ï¼š</div>
                    <textarea id="systemPrompt" class="system-box" rows="4" 
                              placeholder="ä¾‹å¦‚ï¼šä½ æ˜¯ä¸€ä¸ªå‹å–„çš„ä¸­æ–‡æ¸¸æˆå¼€å‘åŠ©æ‰‹ï¼Œå›ç­”åº”ä¸å¡çš®å·´æ‹‰ä¸€æ ·æ²»æ„ˆã€‚"
                    >ä½ æ˜¯ä¸€ä¸ªå‹å–„ã€ä¸“ä¸šçš„ AWaDo Design Studio æ™ºèƒ½åŠ©ç†ï¼Œå›ç­”åº”ä¸å¡çš®å·´æ‹‰ä¸€æ ·æ²»æ„ˆä¸”å¯Œæœ‰åˆ›æ„ï¼Œä¸“æ³¨äºæ¸¸æˆå¼€å‘ã€è®¾è®¡å’Œå·¥ä½œå®¤ä¿¡æ¯ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚</textarea>
                </div>
            </aside>

            <section class="chat">
                <div class="meta">ä¼šè¯å†å² â€” è¯·åœ¨å·¦ä¾§è®¾ç½®æ‚¨çš„ä¸“å± AI èº«ä»½ã€‚</div>
                <div id="messages" class="messages" aria-live="polite">
                    <div class="msg ai">
                        <div style="font-size:13px;color:var(--awado-green);margin-bottom:6px">AWaDo AI</div>
                        <div>
                            æ¬¢è¿æ¥åˆ° AWaDo æ™ºèƒ½è®¾è®¡åŠ©ç†ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨è§£ç­”å…³äºæˆ‘ä»¬å·¥ä½œå®¤ã€æ¸¸æˆé¡¹ç›®ï¼ˆæ¯”å¦‚ã€Šå¡çš®å·´æ‹‰ç¯æ¸¸ä¸–ç•Œã€‹ï¼‰æˆ–é€šç”¨å¼€å‘é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨å‘¢ï¼Ÿ
                        </div>
                    </div>
                </div>

                <footer>
                    <textarea id="input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ˆShift+Enter æ¢è¡Œï¼‰"></textarea>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                        <button id="sendBtn" class="btn">å‘é€</button>
                        <button id="clearBtn" class="btn secondary">æ¸…ç©º</button>
                    </div>
                </footer>
            </section>
        </div>
    </div>

    <script>
        // ğŸš¨ ä¸¥é‡å®‰å…¨è­¦å‘Šï¼šæ­¤ API Key å·²ç¡¬ç¼–ç åˆ°å‰ç«¯ã€‚ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹æºä»£ç å¹¶è·å–ã€‚
        // ä»…ç”¨äºç§äººã€æµ‹è¯•æˆ–å­¦ä¹ ç”¨é€”ã€‚ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä½¿ç”¨åç«¯ä»£ç†ã€‚
        const AWADO_API_KEY = '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';
        
        const modelSelect = document.getElementById('model');
        const messagesEl = document.getElementById('messages');
        const inputEl = document.getElementById('input');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const systemPromptEl = document.getElementById('systemPrompt');

        function addMessage(role, text){
            const div = document.createElement('div');
            div.className = 'msg ' + (role==='user'?'user':'ai');
            div.innerHTML = '<div style="font-size:13px; margin-bottom:6px">'+(role==='user'? 'ä½ ':'AWaDo AI')+'</div>' +
                            '<div>' + escapeHtml(text).replace(/\n/g,'<br>') + '</div>';
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function escapeHtml(unsafe){
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/\"/g, "&quot;")
                .replace(/'/g, "&#039;")
        }

        sendBtn.addEventListener('click', sendMessage);
        clearBtn.addEventListener('click', () => { 
            messagesEl.innerHTML=''; 
            inputEl.value=''; 
            // æ¸…ç©ºæ—¶é‡æ–°æ·»åŠ æ¬¢è¿æ¶ˆæ¯
            addMessage('ai', 'æ¬¢è¿æ¥åˆ° AWaDo æ™ºèƒ½è®¾è®¡åŠ©ç†ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨è§£ç­”å…³äºæˆ‘ä»¬å·¥ä½œå®¤ã€æ¸¸æˆé¡¹ç›®ï¼ˆæ¯”å¦‚ã€Šå¡çš®å·´æ‹‰ç¯æ¸¸ä¸–ç•Œã€‹ï¼‰æˆ–é€šç”¨å¼€å‘é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨å‘¢ï¼Ÿ');
        });

        inputEl.addEventListener('keydown', (e)=>{
            if(e.key === 'Enter' && !e.shiftKey){
                e.preventDefault(); sendMessage();
            }
        });

        async function sendMessage(){
            const text = inputEl.value.trim();
            if(!text) return;
            
            // åœ¨å‘é€å‰è·å–å½“å‰æ‰€æœ‰æ¶ˆæ¯ï¼Œç”¨äºä¸Šä¸‹æ–‡ä¼ é€’
            const existingMsgs = Array.from(messagesEl.children).map(n => {
                const content = n.children[1] ? n.children[1].innerText : '';
                const role = n.classList.contains('user') ? 'user' : 'assistant';
                return { role, content };
            }).filter(msg => msg.content); 

            addMessage('user', text);
            inputEl.value = '';

            const apiKey = AWADO_API_KEY; // ç¡¬ç¼–ç çš„ API Key
            if(!apiKey){
                addMessage('ai', 'ğŸš¨ API Key æœªé…ç½®ï¼Œè¯·æ£€æŸ¥ä»£ç ä¸­çš„ `AWADO_API_KEY` å˜é‡ã€‚');
                return;
            }

            // æ„é€  messages
            const systemText = systemPromptEl.value.trim();
            const payloadMessages = [];
            if(systemText) payloadMessages.push({role:'system', content: systemText});
            
            // é‡è¦çš„ä¸Šä¸‹æ–‡ç®¡ç†ï¼šæ·»åŠ æ‰€æœ‰å†å²æ¶ˆæ¯å’Œå½“å‰ç”¨æˆ·æ¶ˆæ¯
            payloadMessages.push(...existingMsgs);
            payloadMessages.push({role:'user', content: text});

            addMessage('ai', 'æ­£åœ¨è¯·æ±‚â€¦');

            try{
                const res = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + apiKey
                    },
                    body: JSON.stringify({
                        model: modelSelect.value,
                        messages: payloadMessages,
                        max_tokens: 800,
                        temperature: 0.7
                    })
                });

                // ç§»é™¤ä¹‹å‰çš„â€œæ­£åœ¨è¯·æ±‚â€¦â€æ¶ˆæ¯ï¼ˆæœ€åä¸€æ¡ aiï¼‰
                const aiMsgs = messagesEl.querySelectorAll('.msg.ai');
                if(aiMsgs.length) aiMsgs[aiMsgs.length-1].remove();

                if(!res.ok){
                    const errText = await res.text();
                    addMessage('ai', 'è¯·æ±‚å¤±è´¥ï¼š' + res.status + '\n' + errText);
                    console.error('OpenAI error', res.status, errText);
                    return;
                }

                const data = await res.json();
                const reply = (data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content) || JSON.stringify(data);
                
                addMessage('ai', reply.trim());

            }catch(err){
                console.error(err);
                addMessage('ai', 'è°ƒç”¨ API å‡ºé”™ï¼š' + err.message);
            }
        }

        // æ–¹ä¾¿ï¼šæŠŠæœ¬åœ°ä¼šè¯å¯¼å‡ºä¸º JSON
        window.addEventListener('keydown', (e)=>{
            if(e.ctrlKey && e.key.toLowerCase()==='s'){
                e.preventDefault();
                exportConversation();
            }
        });

        function exportConversation(){
            const systemPrompt = systemPromptEl.value.trim();
            const items = Array.from(messagesEl.children).map(n => {
                const role = n.classList.contains('user')? 'user':'assistant';
                const content = n.children[1] ? n.children[1].innerText.trim() : ''; 
                return {role, content};
            }).filter(item => item.content !== 'æ­£åœ¨è¯·æ±‚â€¦'); 
            
            const conversation = {
                system: systemPrompt,
                messages: items
            };

            const blob = new Blob([JSON.stringify(conversation, null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'awado_chat_history.json'; a.click();
            URL.revokeObjectURL(url);
        }

    </script>
</body>
</html>
