<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AWaDo èŠå¤©æœºå™¨äºº</title>
    <link rel="icon" href="awado_icon.png" type="image/png">
    <style>
        /* AWaDo å“ç‰Œé…è‰²ä¸åŸºç¡€è®¾ç½® */
        :root{
            --awado-bg: #0f1724; 
            --awado-card: #1e1e1e; /* ç”¨äº app å®¹å™¨ */
            --awado-text: #e6eef6; 
            --awado-muted: #9aa4b2; 
            --awado-green: #2ecc71; 
            --awado-red: #e74c3c; 
            --awado-blue: #3498db; 
            --chat-bg: #0b1220; /* èŠå¤©èƒŒæ™¯è‰² */
            --footer-height: 80px; 
            --app-height: 100vh; 
        }
        
        /* 1. æ ¸å¿ƒä¿®å¤ï¼šç§»åŠ¨ç«¯ä½¿ç”¨ JS åŠ¨æ€è®¡ç®—çš„ --app-height */
        html,body{
            height: var(--app-height); 
            margin:0;
            padding: 0;
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body{
            background:var(--awado-bg);
            color:var(--awado-text);
            display:flex;
            justify-content:center;
        }

        /* 2. APP å®¹å™¨ï¼šåœ¨æ‰‹æœºç«¯å…¨å±ï¼Œæ¡Œé¢ç«¯å›ºå®šå°ºå¯¸ */
        .app{
            width: 100%; 
            max-width: none; 
            height: var(--app-height); 
            background:var(--awado-card); 
            border-radius:0; 
            box-shadow:none; 
            display:grid;
            grid-template-rows:60px 1fr; 
            overflow:hidden; 
        }
        
        /* ==================== å¤´éƒ¨ï¼ˆHeaderï¼‰ ==================== */
        header{
            display:flex;
            gap:10px;
            align-items:center;
            padding:10px 15px; 
            border-bottom:1px solid rgba(255,255,255,.05);
            background-color: #2c2c2c; 
        }
        header .logo{
            width:35px; 
            height:35px;
            border-radius:6px; 
            object-fit: contain;
        }
        header h1{font-size:16px;margin:0;color:var(--awado-red);font-weight:600;} 
        .controls{margin-left:auto;} 
        .controls select { display: none; }
        .small{display: none;} 

        /* ==================== ä¸»é¢æ¿ï¼ˆPaneï¼‰ ==================== */
        .pane{
            display:flex;
            flex-direction: column;
            gap:0;
            padding:0;
            grid-row: 2 / 3;
            overflow: hidden; 
        }
        .sidebar{
            display: none; 
        }
        
        .chat{
            flex:1;
            background:var(--chat-bg); 
            padding:0; 
            border-radius:0; 
            display:flex;
            flex-direction:column;
            position: relative; 
            overflow: hidden; 
        }
        
        /* ==================== æ¶ˆæ¯åŒºï¼ˆMessagesï¼‰- æ ¸å¿ƒæ»šåŠ¨åŒºåŸŸ ==================== */
        .messages{
            padding:15px; 
            padding-bottom: var(--footer-height); 
            overflow-y:auto; 
            -webkit-overflow-scrolling: touch; 
            flex:1; 
            display:flex;
            flex-direction:column;
            gap:12px;
        }
        .messages::-webkit-scrollbar {width: 0;} 
        
        .msg{
            max-width:90%; 
            padding:10px 12px; 
            border-radius:10px; 
            line-height:1.4; 
            font-size: 14px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1)
        }
        
        .msg.user{ margin-left:auto; background:linear-gradient(135deg,var(--awado-blue),#2980b9); color:white; border:1px solid rgba(52,152,219,.15); }
        .msg.ai{ margin-right:auto; background:linear-gradient(135deg,#1f3d33,#0b2d23); color:var(--awado-text); border:1px solid rgba(46,204,113,.15); }
        .msg > div:first-child{font-weight: bold; margin-bottom: 3px; font-size: 12px;}
        .msg.user > div:first-child{color: rgba(255,255,255,0.8);}
        .msg.ai > div:first-child{color: var(--awado-green);}

        .meta{
            font-size:11px;
            color:var(--awado-muted);
            padding:8px 15px; 
            border-bottom: 1px dashed rgba(255,255,255,.03); 
            text-align: center;
        }
        
        /* ==================== åº•éƒ¨ï¼ˆFooterï¼‰ - ç»å¯¹å®šä½å›ºå®šåº•éƒ¨ï¼ˆæ‰‹æœºç«¯ï¼‰ ==================== */
        footer{
            position: absolute; 
            bottom: 0;
            left: 0;
            right: 0;
            display:flex;
            gap:8px;
            padding:10px 15px;
            border-top:1px solid rgba(255,255,255,.05);
            align-items:flex-end;
            background-color: #2c2c2c;
            min-height: var(--footer-height); 
            box-sizing: border-box; 
            flex-shrink: 0;
            z-index: 10; 
        }
        textarea{
            flex:1;
            min-height:48px;
            max-height:100px;
            resize: none; 
            padding:10px;
            border-radius:8px;
            background:#333; 
            border:1px solid rgba(255,255,255,.1);
            color:var(--awado-text);
            font-size:14px;
        }
        textarea:focus { border-color: var(--awado-green); outline: none; }
        
        .btn{
            padding:8px 12px;
            border-radius:8px;
            font-weight:600;
        }
        .footer-btns{
            display:flex;
            flex-direction:column;
            gap:6px;
            flex-shrink: 0;
        }

        /* 3. æ¡Œé¢ç«¯æ ·å¼ (Media Query è¦†ç›–) */
        @media (min-width: 600px) {
            body {
                align-items: center; 
                padding: 24px;
            }
            .app{
                width:900px;
                max-width:95%;
                height:720px;
                border-radius:12px;
                box-shadow:0 8px 30px rgba(0,0,0,.5);
                grid-template-rows:72px 1fr;
                height: 720px; 
            }
            header{ padding: 14px 18px; height: 72px; }
            header .logo{ width:40px; height:40px; }
            header h1{ font-size:18px; }
            .small{display: block;} 
            
            /* å…³é”®ä¿®æ”¹ 1: pane ç§»é™¤é¡¶éƒ¨å¡«å……ï¼Œä»…ä¿ç•™å·¦å³å’Œåº•éƒ¨å¡«å…… */
            .pane{
                flex-direction: row; 
                gap:0; 
                padding: 0 18px 12px 18px; /* é¡¶éƒ¨0ï¼Œå·¦å³18pxï¼Œåº•éƒ¨12px */
            }
            .sidebar{
                display: none; 
            }
            .chat{
                flex:1; 
                background: var(--chat-bg); 
                position: static; 
                box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
                border-radius: 10px; 
                padding: 0; 
                box-sizing: border-box; 
            }
            
            /* å…³é”®ä¿®æ”¹ 2: meta å¢åŠ é¡¶éƒ¨å¡«å……ï¼Œå¹¶ç»Ÿä¸€å·¦å³å¡«å…… */
            .meta {
                 padding: 12px 18px 8px 18px; /* é¡¶éƒ¨å¢åŠ å¡«å…… */
            }
            
            /* å…³é”®ä¿®æ”¹ 3: messages ç»Ÿä¸€å¡«å…… */
            .messages{
                flex: 1; 
                padding: 15px 18px; 
                gap:15px;
            }

            /* å…³é”®ä¿®æ”¹ 4: footer è°ƒæ•´å‚ç›´å¯¹é½ */
            .chat footer {
                position: static;
                border-top: 1px solid rgba(255,255,255,.05);
                padding:12px 18px; 
                min-height: initial;
                /* æ ¸å¿ƒä¿®å¤ï¼šå‚ç›´å±…ä¸­ */
                align-items: center; 
            }
            
            /* è°ƒæ•´èŠå¤©æ°”æ³¡ */
            .msg {
                max-width: 85%; 
                padding:12px 15px;
            }
            .msg.user {
                margin-left: auto;
                margin-right: 0;
            }
            .msg.ai {
                margin-right: auto;
                margin-left: 0;
            }
            
            /* è°ƒæ•´è¾“å…¥æ¡†å’ŒæŒ‰é’®çš„ç›¸å¯¹ä½ç½® */
            textarea {
                min-height:56px;
                max-height:120px;
                resize: vertical; 
                padding: 12px;
                font-size: 15px;
            }
            .footer-btns{ 
                gap:8px; 
                /* ç¡®ä¿æŒ‰é’®ç»„å±…ä¸­å¯¹é½ */
                align-self: center; 
            }
            .btn{ padding:10px 14px; font-size: initial; }
            
        }
    </style>
</head>
<body>
    <div class="app" role="application">
        <header>
            <img src="awado_icon.png" alt="AWaDo AI Logo" class="logo"> 
            <div>
                <h1>AWaDo èŠå¤©æœºå™¨äºº</h1>
                <div class="small">åŸºäºè§„åˆ™çš„èŠå¤©ç³»ç»Ÿï¼Œå®Œå…¨å…è´¹ã€‚</div>
            </div>
            <div class="controls">
            </div>
        </header>

        <div class="pane">
            <aside class="sidebar">
                </aside>

            <section class="chat">
                <div class="meta">ä¼šè¯å†å² â€” æœ¬ç³»ç»Ÿä¸ä¼šä¿å­˜æ‚¨çš„èŠå¤©è®°å½•ã€‚</div>
                <div id="messages" class="messages" aria-live="polite">
                    </div>

                <footer>
                    <textarea id="input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ˆEnter å‘é€ï¼‰"></textarea>
                    <div class="footer-btns">
                        <button id="sendBtn" class="btn">å‘é€</button>
                        <button id="clearBtn" class="btn secondary">æ¸…ç©º</button>
                    </div>
                </footer>
            </section>
        </div>
    </div>

    <script>
        const messagesEl = document.getElementById('messages');
        const inputEl = document.getElementById('input');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const footerEl = document.querySelector('footer');

        // ===============================================
        // æœºå™¨äººåˆå§‹æ¶ˆæ¯å†…å®¹ (æ•´åˆäº†ä¾§è¾¹æ ä¿¡æ¯)
        // ===============================================
        const initialAiMessage = `
            æ¬¢è¿æ¥åˆ° AWaDo èŠå¤©æœºå™¨äººï¼æˆ‘æ˜¯åŸºäºé¢„è®¾è§„åˆ™çš„åŠ©æ‰‹ã€‚è¯·é—®æ‚¨æœ‰ä»€ä¹ˆæƒ³äº†è§£çš„ AWaDo å·¥ä½œå®¤ä¿¡æ¯å—ï¼Ÿ

            ---
            
            **ğŸ’¡ å·¥ä½œåŸç†ï¼š**
            1. æœ¬ç³»ç»Ÿåœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ APIã€‚
            2. æœºå™¨äººé€šè¿‡å…³é”®è¯åŒ¹é…æ¥å›å¤é¢„è®¾çš„ç­”æ¡ˆã€‚
            3. å¦‚æœæ‚¨è¯¢é—®è¶…å‡ºé¢„è®¾è§„åˆ™çš„é—®é¢˜ï¼Œå®ƒå°†å›å¤é»˜è®¤ä¿¡æ¯ã€‚

            **â­ æ‚¨å¯ä»¥å°è¯•é—®ï¼š**
            - å¡çš®å·´æ‹‰ï¼ˆæ¸¸æˆåï¼‰
            - æˆå‘˜åˆ—è¡¨
            - ä¸»é¢˜æ›²
            - ä½ å¥½ / è°¢è°¢
            
        `;

        // ===============================================
        // æ ¸å¿ƒè§„åˆ™ï¼šå…³é”®è¯åŒ¹é… (ä¿æŒä¸å˜)
        // ===============================================
        const rules = [
            {
                keywords: ['å¡çš®å·´æ‹‰', 'æ¸¸æˆ', 'ä½œå“', 'Capybara','game'],
                response: 'æˆ‘ä»¬çš„ä¸»æ‰“ä½œå“æ˜¯ã€Šå¡çš®å·´æ‹‰ç¯æ¸¸ä¸–ç•Œã€‹ï¼åœ¨è¿™æ¬¾æ²»æ„ˆç³»å†’é™©æ¸¸æˆä¸­ï¼Œæ‚¨å°†é™ªä¼´å¯çˆ±çš„å¡çš®å·´æ‹‰æ¢ç´¢ä¸–ç•Œï¼Œè§£å†³å°è°œé¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªæ”¾æ¾å¿ƒçµçš„æ—…ç¨‹ï¼'
            },
            {
                keywords: ['æˆå‘˜', 'å›¢é˜Ÿ', 'åˆ¶ä½œäºº','äºº'],
                response: 'AWaDo å·¥ä½œå®¤çš„æ ¸å¿ƒæˆå‘˜åŒ…æ‹¬ï¼šProgrammer (ZIJUN), Sponsor (YUHENG), Director (SANGYUAN), Language (QINGHUA), Character Design (LEONGYI), å’Œ Art (SHUSHENG)ã€‚æˆ‘ä»¬æ˜¯å…­äººå°å›¢é˜Ÿï¼'
            },
            {
                keywords: ['ä¸»é¢˜æ›²', 'èƒŒæ™¯éŸ³ä¹', 'BGM','éŸ³ä¹','music'],
                response: 'æˆ‘ä»¬çš„ä¸»é¢˜æ›²æ˜¯ `topic_bgm.mp3`ã€‚æ‚¨å¯ä»¥åœ¨ä¸»é¡µä¸Šç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬ï¼å®ƒèƒ½å¸¦ç»™æ‚¨å®é™ä¸æ¬¢ä¹ã€‚'
            },
            {
                keywords: ['ä½ å¥½', 'åœ¨å—', 'å–‚','hallo','hi'],
                response: 'ä½ å¥½ï¼æˆ‘æ˜¯ AWaDo è§„åˆ™èŠå¤©æœºå™¨äººï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚è¯·é—®æ‚¨æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ'
            },
            {
                keywords: ['è°¢è°¢', 'æ„Ÿè°¢', 'å†è§','tq'],
                response: 'ä¸å®¢æ°”ï¼å¸Œæœ›æ‚¨åœ¨ AWaDo çš„ç½‘ç«™ä¸Šç©å¾—æ„‰å¿«ã€‚å†è§ï¼Œç¥æ‚¨æ‹¥æœ‰ç¾å¥½çš„ä¸€å¤©ï¼'
            }
            ,
            {
                keywords: ['è”ç³»', 'Telegram', 'TG'],
                response: 'æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»ä¸»é¡µä¾§è¾¹æ çš„â€œå‰å¾€ Telegramâ€æŒ‰é’®è”ç³»æˆ‘ä»¬ï¼Œæä¾›åé¦ˆæˆ–å¯»æ±‚æ”¯æŒã€‚'
            },
            {
                keywords: ['gay', 'åŒæ€§æ‹', 'åŒå¿—','ç”·åŒ'],
                response: 'æˆ‘ä¸æ˜¯gayï¼Œä½†ruitaoæ˜¯ã€‚'
            },
            {
                keywords: ['ruitao', 'sangyuan', 'leongyi','qinghua','shusheng','yuheng'],
                response: 'æ˜¯gayã€‚'
            }
        ];

        const defaultResponse = 'æŠ±æ­‰ï¼Œæˆ‘åªæ˜¯ä¸€åè§„åˆ™æœºå™¨äººï¼Œæ— æ³•ç†è§£æ‚¨å¤æ‚çš„é—®é¢˜ã€‚';


        function addMessage(role, text){
            const div = document.createElement('div');
            div.className = 'msg ' + (role==='user'?'user':'ai');
            // å°† Markdown é£æ ¼çš„ **ç²—ä½“** å’Œ --- åˆ†éš”ç¬¦è½¬æ¢ä¸º HTML
            const formattedText = escapeHtml(text)
                                    .replace(/\n/g, '<br>')
                                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                    .replace(/---/g, '<hr style="border:0; border-top: 1px solid rgba(255,255,255,0.1); margin: 8px 0;">');

            div.innerHTML = '<div style="font-size:13px; margin-bottom:6px">'+(role==='user'? 'ä½ ':'AWaDo æœºå™¨äºº')+'</div>' +
                            '<div>' + formattedText + '</div>';
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight; 
        }

        function escapeHtml(unsafe){
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/\"/g, "&quot;")
                .replace(/'/g, "&#039;")
        }
        
        function handleRuleBasedResponse(userInput) {
            const lowerCaseInput = userInput.toLowerCase();
            for (const rule of rules) {
                for (const keyword of rule.keywords) {
                    if (lowerCaseInput.includes(keyword.toLowerCase())) {
                        return rule.response;
                    }
                }
            }
            return defaultResponse;
        }

        function sendMessage(){
            const text = inputEl.value.trim();
            if(!text) return;
            
            addMessage('user', text);
            inputEl.value = '';

            const reply = handleRuleBasedResponse(text);
            
            setTimeout(() => {
                addMessage('ai', reply);
            }, 500); 
        }

        // ===============================================
        // ç§»åŠ¨ç«¯é«˜åº¦/æ»šåŠ¨ä¿®å¤å‡½æ•°
        // ===============================================
        const setAppHeight = () => {
            // ä»…åœ¨çª„å±ä¸‹ä¿®å¤ vh
            if (window.innerWidth < 600) {
                const doc = document.documentElement;
                doc.style.setProperty('--app-height', `${window.innerHeight}px`);
            } else {
                document.documentElement.style.setProperty('--app-height', `720px`);
            }
        };

        const adjustMessagesPadding = () => {
            if (window.innerWidth < 600) {
                const footerHeight = footerEl.offsetHeight; 
                document.documentElement.style.setProperty('--footer-height', `${footerHeight + 15}px`); 
            } else {
                document.documentElement.style.setProperty('--footer-height', `15px`);
            }
            messagesEl.scrollTop = messagesEl.scrollHeight; 
        };
        
        // ===============================================
        // åˆå§‹åŒ–å‡½æ•°
        // ===============================================
        function initializeChat() {
            setAppHeight();
            adjustMessagesPadding();
            // æ³¨å…¥åŒ…å«ä¿¡æ¯çš„æ¬¢è¿è¯­
            addMessage('ai', initialAiMessage);
        }

        // äº‹ä»¶ç›‘å¬
        sendBtn.addEventListener('click', sendMessage);
        
        clearBtn.addEventListener('click', () => { 
            messagesEl.innerHTML=''; 
            inputEl.value=''; 
            // æ¸…ç©ºæ—¶é‡æ–°å‘é€åŒ…å«ä¿¡æ¯çš„æ¬¢è¿è¯­
            addMessage('ai', initialAiMessage);
        });

        inputEl.addEventListener('keydown', (e)=>{
            if(e.key === 'Enter' && !e.shiftKey){
                e.preventDefault(); sendMessage();
            }
        });
        
        window.addEventListener('resize', () => {
            setAppHeight(); 
            adjustMessagesPadding(); 
        });

        inputEl.addEventListener('input', adjustMessagesPadding);
        
        window.onload = initializeChat;

        inputEl.addEventListener('focus', () => {
            setTimeout(() => {
                messagesEl.scrollTop = messagesEl.scrollHeight;
            }, 300); 
        });

    </script>
</body>
</html>
